<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="author" content="tosainu">
    <meta name="generator" content="Vim">
    <title>Node.js Chat.</title>
  </head>
  <body>
    <h1>Node.js&nbsp;Chat&nbsp;&nbsp;(KUSO)</h1>

    <form name="send">
      <p>Name:<input type="text" name="name" size="20">&nbsp;
        Text:<input type="text" name="text" size="40">
        <input type="button" value="post" onclick="post();"/>
      </p>
    </form>

    <hr>

    <div id="log">
    </div>

  </body>
    
  <script src="/socket.io/socket.io.js"></script>

  <script>
    var socket = io.connect('http://myon.pgw.jp:3000/');

    // User join.
    socket.on('join', function (data) {
      var element = document.createElement("div");
      (data.state)? element.innerText = data.id + ' was connected.' : element.innerText = data.id + ' was disconnected.'; 
      var object = document.getElementById("log");
      object.appendChild(element);
    });
    
    // Post Text.
    function post(){
      socket.emit('post', { name: document.send.name.value, text: document.send.text.value });
      document.send.text.value = "";
    }

    // Get Posts.
    socket.on('post', function (data) {
      var element = document.createElement("div");
      element.innerText = data.name + ' : ' + data.text; 
      var object = document.getElementById("log");
      object.appendChild(element);
    });

    function submitStop(e){
      if(!e) var e = window.event;
      if(e.keyCode == 13) {
        post();
        return false;
      }
    }

    window.onload = function (){
      var list = document.getElementsByTagName("input");
      for(var i=0; i<list.length; i++){
        if(list[i].type == 'text' || list[i].type == 'password'){
          list[i].onkeypress = function (event){
            return submitStop(event);
          };
        }
      }
    }
  </script>
</html>
